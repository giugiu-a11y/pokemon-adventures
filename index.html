<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Adventures - Red Chapter</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', sans-serif;
            padding: 20px;
        }
        h1 { color: #ffcb05; text-shadow: 2px 2px 0 #3466af; margin-bottom: 15px; }
        .subtitle { color: #aaa; margin-bottom: 20px; }
        #game-container {
            width: 100%;
            max-width: 800px;
            height: 600px;
            background: #000;
            border: 3px solid #ffcb05;
            border-radius: 10px;
        }
        .controls { margin-top: 20px; color: #888; font-size: 0.85em; text-align: center; }
        .controls kbd { background: #333; padding: 3px 8px; border-radius: 4px; }
        .note { margin-top: 15px; color: #4f4; font-size: 0.9em; }
        #dynamic-hint {
            margin-top: 8px;
            color: #aef;
            font-size: 0.85em;
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body>
    <h1>üéÆ Pok√©mon Adventures</h1>
    <p class="subtitle">Red Chapter - Baseado no Mang√°</p>
    <div id="game-container"></div>
    <div class="controls">
        <p><kbd>‚Üë</kbd><kbd>‚Üì</kbd><kbd>‚Üê</kbd><kbd>‚Üí</kbd> Mover | <kbd>Z</kbd> A | <kbd>X</kbd> B | <kbd>Enter</kbd> Start</p>
        <p class="note">‚ú® NEW GAME ‚Üí Direto pro quarto (pula intro Oak)!</p>
        <p id="dynamic-hint">üó∫Ô∏è Explore e converse com NPCs importantes</p>
    </div>

    <script>
        // === SISTEMA DE HINTS DIN√ÇMICO (sem spoilers) ===
        // Hints s√£o baseados no progresso do jogador - sem revelar plot!
        const HINTS = [
            // Estado inicial / explora√ß√£o geral
            { icon: "üó∫Ô∏è", text: "Explore ao norte de Pallet Town" },
            { icon: "üí¨", text: "Converse com NPCs - eles t√™m dicas importantes" },
            { icon: "üåø", text: "Siga a hist√≥ria do mang√° Pok√©mon Adventures" },
            { icon: "üîç", text: "Preste aten√ß√£o em eventos nas rotas" },
            { icon: "‚öîÔ∏è", text: "Capture Pok√©mon e treine para os Gyms" },
            { icon: "üèÜ", text: "Derrote os 8 Gym Leaders e v√° ao Pok√©mon League" },
            { icon: "üìñ", text: "Cada √°rea tem segredos do mang√° para descobrir" },
            { icon: "üåü", text: "Explore todas as rotas com aten√ß√£o" },
        ];

        // Sistema de hints din√¢mico com fade
        let currentHintIndex = 0;
        const hintEl = document.getElementById('dynamic-hint');

        function showHint(hint) {
            hintEl.style.opacity = '0';
            setTimeout(() => {
                hintEl.textContent = hint.icon + ' ' + hint.text;
                hintEl.style.opacity = '1';
            }, 500);
        }

        function rotateHint() {
            currentHintIndex = (currentHintIndex + 1) % HINTS.length;
            showHint(HINTS[currentHintIndex]);
        }

        // Mostrar primeiro hint
        showHint(HINTS[0]);

        // Rotacionar a cada 5 segundos
        setInterval(rotateHint, 5000);

        // Quando o jogo iniciar, tentar ler VAR_MANGA_AUTOWALK_STATE para hints contextuais
        // VAR_MANGA_AUTOWALK_STATE = 0x40FF ‚Üí √≠ndice 0xFF=255 no array vars[]
        // vars[] est√° em SaveBlock1 + 0x1000, cada var √© u16 (2 bytes)
        // Logo: offset dentro de SaveBlock1 = 0x1000 + (0x40FF - 0x4000) * 2 = 0x1000 + 0x1FE = 0x11FE
        const VAR_OFFSET_IN_SAVEBLOCK = 0x11FE;

        // Hints contextuais por estado do manga (sem spoilers!)
        const STATE_HINTS = {
            // --- Pallet Town / Viridian ---
            0:  { icon: "üè†", text: "Explore ao norte de Pallet Town" },
            1:  { icon: "üè†", text: "Explore ao norte de Pallet Town" },
            2:  { icon: "üè†", text: "Explore ao norte de Pallet Town" },
            3:  { icon: "üå≤", text: "Continue explorando ao norte..." },
            4:  { icon: "üå≤", text: "Algo estranho na Viridian Forest..." },
            5:  { icon: "üî¨", text: "Visite o Professor Oak em Pallet Town" },
            6:  { icon: "üî¨", text: "Visite o Professor Oak em Pallet Town" },
            // --- Pewter City ---
            7:  { icon: "üõ§Ô∏è", text: "Siga pela Route 3 ao norte de Pewter" },
            8:  { icon: "üü°", text: "Procure algo especial em Pewter City" },
            9:  { icon: "‚öîÔ∏è", text: "Desafie o Gym de Pewter City" },
           10:  { icon: "üèÜ", text: "Continue para Cerulean City" },
            // --- Cerulean City / Misty ---
           11:  { icon: "üíß", text: "Desafie Misty em Cerulean Gym" },
           12:  { icon: "üåâ", text: "Explore ao norte pela Nugget Bridge" },
            // --- Route 24 / Vermilion ---
           13:  { icon: "üî∂", text: "Investigue a Nugget Bridge ao norte" },
           14:  { icon: "‚ö°", text: "Lt. Surge espera em Vermilion City" },
            // --- Route 12 / Lavender ---
           15:  { icon: "üò¥", text: "Algo bloqueia a Route 12..." },
            // --- Celadon City / Erika ---
           16:  { icon: "üå∏", text: "Erika aguarda em Celadon City" },
           17:  { icon: "üå∏", text: "Explore mais Celadon City" },
            // --- Game Corner ---
           18:  { icon: "üé∞", text: "Algo suspeito acontece no Game Corner" },
            // --- Saffron City / Silph Co ---
           19:  { icon: "üè¢", text: "Invas√£o em Saffron City ‚Äî entre no Silph Co." },
           20:  { icon: "üî¥", text: "O Silph Co. est√° em perigo ‚Äî ajude quem precisar" },
            // --- Fuchsia City / Koga ---
           21:  { icon: "‚ò†Ô∏è", text: "Koga aguarda em Fuchsia City" },
            // --- Eevee / Celadon ---
           22:  { icon: "ü¶ä", text: "Uma captura especial te espera em Celadon" },
           23:  { icon: "‚ú®", text: "Cuide bem do seu novo companheiro" },
            // --- Sabrina / Saffron Gym ---
           24:  { icon: "üîÆ", text: "Sabrina domina o Saffron Gym" },
           25:  { icon: "üß†", text: "Use estrat√©gia contra a l√≠der ps√≠quica" },
            // --- Cinnabar Island / Blaine ---
           26:  { icon: "üåã", text: "Blaine aguarda em Cinnabar Island" },
           27:  { icon: "üî•", text: "Enfrente o calor do Cinnabar Gym" },
            // --- Elite Four ---
           28:  { icon: "üèüÔ∏è", text: "Desafio final: a Pokemon League te aguarda" },
           29:  { icon: "üÉè", text: "O primeiro dos Elite Four est√° pronto" },
           30:  { icon: "üëª", text: "Continue na Pokemon League..." },
           31:  { icon: "üêâ", text: "O campe√£o est√° cada vez mais pr√≥ximo" },
            // --- Epilogue ---
           32:  { icon: "üåÖ", text: "O fim da jornada se aproxima..." },
           33:  { icon: "üåÖ", text: "O fim da jornada se aproxima..." },
           34:  { icon: "üåÖ", text: "O fim da jornada se aproxima..." },
           35:  { icon: "üåÖ", text: "O fim da jornada se aproxima..." },
           36:  { icon: "üåü", text: "Uma nova p√°gina come√ßa..." },
           37:  { icon: "üåü", text: "Uma nova p√°gina come√ßa..." },
           38:  { icon: "üåü", text: "Uma nova p√°gina come√ßa..." },
           39:  { icon: "üèÅ", text: "A aventura est√° quase completa" },
           40:  { icon: "üéâ", text: "Parab√©ns ‚Äî voc√™ completou a aventura!" },
        };

        // Tentar ler mem√≥ria do emulador para hints contextuais
        // Isso s√≥ funciona ap√≥s o jogo iniciar
        window.EJS_onGameStart = function() {
            console.log('[Hints] Jogo iniciado - tentando ler VAR_MANGA_AUTOWALK_STATE');
            startContextualHints();
        };

        function startContextualHints() {
            // Tentar a cada 10 segundos ler o estado atual
            setInterval(() => {
                try {
                    const state = readAutoWalkState();
                    if (state !== null && state > 0) {
                        // Encontrar hint contextual para o estado
                        const maxState = Math.max(...Object.keys(STATE_HINTS).map(Number));
                        const key = Math.min(state, maxState);
                        const hint = STATE_HINTS[key] || STATE_HINTS[maxState];
                        hintEl.style.opacity = '0';
                        setTimeout(() => {
                            hintEl.textContent = hint.icon + ' ' + hint.text;
                            hintEl.style.opacity = '1';
                        }, 500);
                    }
                } catch(e) {
                    // Silently fail - usar hints rotativos como fallback
                }
            }, 10000);
        }

        function readAutoWalkState() {
            try {
                const emu = window.EJS_emulator;
                if (!emu || !emu.gameManager) return null;
                const mod = emu.gameManager.Module;
                if (!mod || !mod.HEAPU8) return null;

                // Tentar ler gSaveBlock1Ptr da mem√≥ria IWRAM do GBA
                // Para mGBA LibRetro no WASM, a mem√≥ria GBA √© mapeada em regi√µes do WASM
                // Endere√ßos GBA: IWRAM=0x03000000, EWRAM=0x02000000
                // O mGBA exp√µe buffers de mem√≥ria via retro_get_memory_data
                // Tentativa via asm/fun√ß√µes exportadas
                if (mod.asm && mod.asm.retro_get_memory_data) {
                    // RETRO_MEMORY_SAVE_RAM = 0
                    const ptr = mod.asm.retro_get_memory_data(0);
                    if (ptr) {
                        // Save RAM do GBA FireRed come√ßa com sector 0 do flash
                        // Cada setor = 0x1000 bytes, vars ficam no setor 1 offset 0
                        // Isso depende muito do formato de save - muito vari√°vel
                        return null;
                    }
                }
                return null;
            } catch(e) {
                return null;
            }
        }

        // === Configura√ß√£o do EmulatorJS ===
        EJS_player = '#game-container';
        EJS_gameUrl = './roms/firered.gba';
        EJS_core = 'gba';
        EJS_gameName = 'Pokemon Adventures';
        EJS_color = '#ffcb05';
        EJS_startOnLoaded = true;
        EJS_pathtodata = 'https://cdn.emulatorjs.org/stable/data/';
    </script>
    <script src="https://cdn.emulatorjs.org/stable/data/loader.js"></script>
</body>
</html>
